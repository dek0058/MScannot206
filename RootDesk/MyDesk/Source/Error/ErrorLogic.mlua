---@description "오류 코드를 정의하고 처리하는 로직 입니다"
@Logic
script ErrorLogic extends Logic

	readonly property table errorCodes = {}

	-- Batch
	---@description "알 수 없는 오류가 발생했습니다"
	readonly property string BATCH_UNKNOWN_ERROR = "BATCH_UNKNOWN_ERROR"

	-- Session
	---@description "세션 토큰이 유효하지 않습니다"
	readonly property string SESSION_TOKEN_INVALID_ERROR = "SESSION_TOKEN_INVALID_ERROR"

	-- Login
	---@description "알 수 없는 오류가 발생했습니다"
	readonly property string LOGIN_UNKNOWN_ERROR = "LOGIN_UNKNOWN_ERROR"

	---@description "데이터베이스에 쓰기 오류가 발생했습니다"
	readonly property string LOGIN_DB_WRITE_ERROR = "LOGIN_DB_WRITE_ERROR"

	---@description "로그인이 불가능합니다"
	readonly property string LOGIN_UNABLE = "LOGIN_UNABLE"

	---@description "세션 생성에 실패했습니다"
	readonly property string LOGIN_SESSION_CREATE_ERROR = "LOGIN_SESSION_CREATE_ERROR"

	---@description "유효하지 않은 UID입니다"
	readonly property string LOGIN_INVALID_UID = "LOGIN_INVALID_UID"

	---@description "이미 로그인 요청이 진행 중입니다"
	readonly property string LOGIN_ALREADY_REQUEST = "LOGIN_ALREADY_REQUEST"

	-- User
	---@description "유저 데이터 저장에 실패했습니다"
	readonly property string USER_DATA_STORAGE_WRITE_ERROR = "USER_DATA_STORAGE_WRITE_ERROR"

	-- Character
	---@description "캐릭터를 불러올 수 없습니다"
	readonly property string USER_CHARACTER_LOAD_ERROR = "USER_CHARACTER_LOAD_ERROR"

	-- Character Create
	---@description "캐릭터 이름 확인 중 알 수 없는 오류"
	readonly property string USER_CHECK_CHARACTER_NAME_UNKNOWN_ERROR = "USER_CHECK_CHARACTER_NAME_UNKNOWN_ERROR"

	---@description "이미 존재하는 캐릭터 이름입니다"
	readonly property string USER_CHARACTER_NAME_ALREADY_EXISTS_ERROR = "USER_CHARACTER_NAME_ALREADY_EXISTS_ERROR"

	---@description "캐릭터 생성 중 알 수 없는 오류가 발생하였습니다"
	readonly property string USER_CREATE_CHARACTER_UNKNOWN_ERROR = "USER_CREATE_CHARACTER_UNKNOWN_ERROR"

	---@description "잘못된 캐릭터 슬롯입니다"
	readonly property string USER_CHARACTER_SLOT_INVALID_ERROR = "USER_CHARACTER_SLOT_INVALID_ERROR"

	---@description "이미 해당 슬롯에 캐릭터가 존재합니다"
	readonly property string USER_CHARACTER_SLOT_ALREADY_EXISTS_ERROR = "USER_CHARACTER_SLOT_ALREADY_EXISTS_ERROR"

	---@description "이미 캐릭터 생성 요청이 진행 중입니다"
	readonly property string USER_CREATE_CHARACTER_ALREADY_REQUEST = "USER_CREATE_CHARACTER_ALREADY_REQUEST"

	---@description "캐릭터를 생성하려는 사용자를 찾을 수 없습니다"
	readonly property string USER_CREATE_CHARACTER_USER_NOT_FOUND = "USER_CREATE_CHARACTER_USER_NOT_FOUND"

	---@description "캐릭터 이름은 최소 길이 제한 오류"
	readonly property string USER_CREATE_CHARACTER_NAME_MIN_LENGTH_ERROR = "USER_CREATE_CHARACTER_NAME_MIN_LENGTH_ERROR"

	---@description "캐릭터 이름은 최대 길이 제한 오류"
	readonly property string USER_CREATE_CHARACTER_NAME_MAX_LENGTH_ERROR = "USER_CREATE_CHARACTER_NAME_MAX_LENGTH_ERROR"

	---@description "캐릭터 이름에 사용할 수 없는 문자가 포함되어 있습니다"
	readonly property string USER_CREATE_CHARACTER_NAME_SPECIAL_CHAR_ERROR = "USER_CREATE_CHARACTER_NAME_SPECIAL_CHAR_ERROR"

	---@description "캐릭터 생성 중 데이터베이스 쓰기 오류가 발생했습니다"
	readonly property string USER_CREATE_CHARACTER_DB_WRITE_ERROR = "USER_CREATE_CHARACTER_DB_WRITE_ERROR"

	-- Character Delete
	---@description "캐릭터 삭제 중 알 수 없는 오류가 발생하였습니다"
	readonly property string USER_DELETE_CHARACTER_UNKNOWN_ERROR = "USER_DELETE_CHARACTER_UNKNOWN_ERROR"

	---@description "잘못된 캐릭터 슬롯입니다"
	readonly property string USER_DELETE_CHARACTER_SLOT_INVALID_ERROR = "USER_DELETE_CHARACTER_SLOT_INVALID_ERROR"

	---@description "이미 캐릭터 삭제 요청이 진행 중입니다"
	readonly property string USER_DELETE_CHARACTER_ALREADY_REQUEST = "USER_DELETE_CHARACTER_ALREADY_REQUEST"

	---@description "캐릭터를 삭제하려는 사용자를 찾을 수 없습니다"
	readonly property string USER_DELETE_CHARACTER_USER_NOT_FOUND = "USER_DELETE_CHARACTER_USER_NOT_FOUND"

	---@description "삭제하려는 캐릭터 슬롯을 찾을 수 없습니다"
	readonly property string USER_DELETE_CHARACTER_SLOT_NOT_FOUND_ERROR = "USER_DELETE_CHARACTER_SLOT_NOT_FOUND_ERROR"

	---@description "캐릭터 삭제 중 데이터베이스 쓰기 오류가 발생했습니다"
	readonly property string USER_DELETE_CHARACTER_DB_WRITE_ERROR = "USER_DELETE_CHARACTER_DB_WRITE_ERROR"

	method void OnBeginPlay()

		-- Batch
		self.errorCodes[self.BATCH_UNKNOWN_ERROR] = self.BATCH_UNKNOWN_ERROR
		-- Session
		self.errorCodes[self.SESSION_TOKEN_INVALID_ERROR] = self.SESSION_TOKEN_INVALID_ERROR

		-- Login
		self.errorCodes[self.LOGIN_UNKNOWN_ERROR] = self.LOGIN_UNKNOWN_ERROR
		self.errorCodes[self.LOGIN_DB_WRITE_ERROR] = self.LOGIN_DB_WRITE_ERROR
		self.errorCodes[self.LOGIN_UNABLE] = self.LOGIN_UNABLE
		self.errorCodes[self.LOGIN_SESSION_CREATE_ERROR] = self.LOGIN_SESSION_CREATE_ERROR
		self.errorCodes[self.LOGIN_INVALID_UID] = self.LOGIN_INVALID_UID
		self.errorCodes[self.LOGIN_ALREADY_REQUEST] = self.LOGIN_ALREADY_REQUEST

		-- User
		self.errorCodes[self.USER_DATA_STORAGE_WRITE_ERROR] = self.USER_DATA_STORAGE_WRITE_ERROR

		-- Character
		self.errorCodes[self.USER_CHARACTER_LOAD_ERROR] = self.USER_CHARACTER_LOAD_ERROR

		-- Character Create
		self.errorCodes[self.USER_CHECK_CHARACTER_NAME_UNKNOWN_ERROR] = self.USER_CHECK_CHARACTER_NAME_UNKNOWN_ERROR
		self.errorCodes[self.USER_CHARACTER_NAME_ALREADY_EXISTS_ERROR] = self.USER_CHARACTER_NAME_ALREADY_EXISTS_ERROR
		self.errorCodes[self.USER_CREATE_CHARACTER_UNKNOWN_ERROR] = self.USER_CREATE_CHARACTER_UNKNOWN_ERROR
		self.errorCodes[self.USER_CHARACTER_SLOT_INVALID_ERROR] = self.USER_CHARACTER_SLOT_INVALID_ERROR
		self.errorCodes[self.USER_CHARACTER_SLOT_ALREADY_EXISTS_ERROR] = self.USER_CHARACTER_SLOT_ALREADY_EXISTS_ERROR
		self.errorCodes[self.USER_CREATE_CHARACTER_ALREADY_REQUEST] = self.USER_CREATE_CHARACTER_ALREADY_REQUEST
		self.errorCodes[self.USER_CREATE_CHARACTER_USER_NOT_FOUND] = self.USER_CREATE_CHARACTER_USER_NOT_FOUND
		self.errorCodes[self.USER_CREATE_CHARACTER_NAME_MIN_LENGTH_ERROR] = self.USER_CREATE_CHARACTER_NAME_MIN_LENGTH_ERROR
		self.errorCodes[self.USER_CREATE_CHARACTER_NAME_MAX_LENGTH_ERROR] = self.USER_CREATE_CHARACTER_NAME_MAX_LENGTH_ERROR
		self.errorCodes[self.USER_CREATE_CHARACTER_NAME_SPECIAL_CHAR_ERROR] = self.USER_CREATE_CHARACTER_NAME_SPECIAL_CHAR_ERROR
		self.errorCodes[self.USER_CREATE_CHARACTER_DB_WRITE_ERROR] = self.USER_CREATE_CHARACTER_DB_WRITE_ERROR
		
		-- Character Delete
		self.errorCodes[self.USER_DELETE_CHARACTER_UNKNOWN_ERROR] = self.USER_DELETE_CHARACTER_UNKNOWN_ERROR
		self.errorCodes[self.USER_DELETE_CHARACTER_SLOT_INVALID_ERROR] = self.USER_DELETE_CHARACTER_SLOT_INVALID_ERROR
		self.errorCodes[self.USER_DELETE_CHARACTER_ALREADY_REQUEST] = self.USER_DELETE_CHARACTER_ALREADY_REQUEST
		self.errorCodes[self.USER_DELETE_CHARACTER_USER_NOT_FOUND] = self.USER_DELETE_CHARACTER_USER_NOT_FOUND
		self.errorCodes[self.USER_DELETE_CHARACTER_SLOT_NOT_FOUND_ERROR] = self.USER_DELETE_CHARACTER_SLOT_NOT_FOUND_ERROR
		self.errorCodes[self.USER_DELETE_CHARACTER_DB_WRITE_ERROR] = self.USER_DELETE_CHARACTER_DB_WRITE_ERROR
	end

	---@description "오류를 클라이언트에 표시합니다."
	@ExecSpace("Client")
	method void Throw(string errorCode)
		local errCode = self.errorCodes[errorCode]
		local msg = ""
		if errCode == nil then
			msg = "알 수 없는 오류가 발생했습니다"
		else
			msg = _LocalizationService:GetText(errCode)
		end
		log_error(msg .. " [" .. errCode .. "]")
		_GameClientUILogic:CreateModal(msg, nil)
	end

	---@description "오류 목록을 로그로 출력합니다."
	method void PrintErrors(table errorCodeList)
		if errorCodeList == nil then
			return
		end

		for _, errorCode in pairs(errorCodeList) do
			local msg = self:GetErrorMessage(errorCode)
			log_error(msg .. " [" .. errorCode .. "]")
		end
	end

	---@description "오류 메시지를 반환합니다."
	method string GetErrorMessage(string errorCode)
		local errCode = self.errorCodes[errorCode]
		local msg = ""
		if errCode == nil then
			msg = "알 수 없는 오류가 발생했습니다"
		else
			msg = _LocalizationService:GetText(errCode)
		end
		return msg
	end

end
